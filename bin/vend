#!/usr/bin/env php
<?php

require_once __DIR__ . '/../lib/autoload.php';

if (!function_exists('pcntl_signal')) {
    die("PCNTL support seems to be missing or disabled. See https://github.com/d11wtq/boris/issues/29 for details\n");
}

$boris = new \Boris\Boris('vend on ' . gethostname() . ' > ');
$boris->setInspector(new \Vend\VenditanCommerceOutputInspector);

if (empty($argv)) {
    echo 'Need to provide an App ID (e.g. Sigma) as CLI argument when running vend' . PHP_EOL;
    exit(0);
}
//$boris->onStart(function($worker, $vars){
//    $worker->setLocal('date', date('Y-m-d'));
//});
echo $argv[0];
//$boris->onStart('echo "The date is $date\n";');
$onStartLines = array(
//    "error_reporting(E_ALL ^ E_NOTICE);",
//    "register_shutdown_function('nice_php_shutdown');",

//    'define(\'DOCNET_APP_ID\', !empty($_SERVER[\'DEFAULT_APP_ID\']) ? $_SERVER[\'DEFAULT_APP_ID\'] : \'Central\');',
    'define(\'DOCNET_APP_ID\', \'' . $argv[0] . '\');',
    "require_once('/app/vc-local/custom/admin_html/_shared.php');",
    "require_once('/app/vc-local/custom/config/base-config.php');",
    "require_once('/app/vc-local/custom/config/app_and_db.php');",

//    "Init::init_admin_index();",
//    "SprintRegistry::get()->get_uow()->commit();",
);

foreach ($onStartLines as $onStartLine) {
    $boris->onStart($onStartLine);
}

$config = new \Boris\Config();
$config->apply($boris);

$options = new \Boris\CLIOptionsHandler();
$options->handle($boris);

$boris->start();
